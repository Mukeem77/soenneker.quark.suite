@using Microsoft.AspNetCore.Components.Web

@inherits Soenneker.Quark.Element

<li @attributes="BuildAttributes()" @onclick="HandleClick">
    @ChildContent
</li>

@code {
    public override string? ThemeKey { get; set; } = "ListGroupItem";

    [Parameter]
    public string? ItemName { get; set; }

    [Parameter]
    public bool Disabled { get; set; }

    [Parameter]
    public bool Active { get; set; }

    [Parameter]
    public CssValue<ColorBuilder>? Color { get; set; }

    [CascadingParameter]
    protected ListGroup? ParentListGroup { get; set; }

    protected override Dictionary<string, object> BuildAttributes()
    {
        Dictionary<string, object> attributes = base.BuildAttributes();
        
        AppendToClassAttr(attributes, "list-group-item");
        
        if (ParentListGroup?.Mode == ListGroupMode.Selectable)
            AppendToClassAttr(attributes, "list-group-item-action");
            
        if (Active)
            AppendToClassAttr(attributes, "active");
            
        if (Disabled)
            AppendToClassAttr(attributes, "disabled");

        if (Color is not null && !Color.Value.IsEmpty)
        {
            string v = Color.Value.ToString().Trim();

            if (Color.Value.IsCssClass)
            {
                if (v.StartsWith("list-group-item-", StringComparison.Ordinal))
                    AppendToClassAttr(attributes, v);
                else
                    AppendToClassAttr(attributes, $"list-group-item-{v}");
            }
        }

        if (Disabled)
            attributes["aria-disabled"] = "true";

        return attributes;
    }

    protected override async Task HandleClick(MouseEventArgs args)
    {
        if (Disabled)
            return;

        if (ParentListGroup is not null && !string.IsNullOrEmpty(ItemName))
            await ParentListGroup.SelectItem(ItemName);

        await base.HandleClick(args);
    }
}
